input {
  file {
    mode => "read"
    type => "json"
    codec => "json"
    path => "/usr/share/logstash/ingest_data/*WinEventLog-Security.json"
  }  
}

filter { 
mutate {
    rename => ["Accesses", "winlog.access.permissions"]
    rename => ["Access_Mask", "winlog.access.mask"]
    rename => ["Access_Reasons", "winlog.access.reasons"]
    rename => ["Account_Domain", "user.domain"]
    rename => ["Account_Name", "user.name"]
    rename => ["Additional_Information", "winlog.additional.info"]
    rename => ["Advanced_Options", "winlog.boot_legacy.flag"]
    rename => ["Authentication_Package", "winlog.auth.logon"]
    rename => ["Authentication_Package_Name", "winlog.auth.loaded"]
    rename => ["ComputerName", "winlog.computer_name"]
    rename => ["Configuration_Access_Policy", "winlog.boot.policy"]
    rename => ["Creator_Process_ID", "process.ppid"]
    rename => ["Creator_Process_Name", "botes.process.pname"]
    rename => ["date_zone", "event.timezone"]
    rename => ["Desired_Access", "winlog.access.desired"]
    rename => ["Disable_Integrity_Checks", "winlog.integrity_checks.flag"]
    rename => ["dvc_nt_host", "host.hostname"]
    rename => ["Elevated_Token", "winlog.elevated_token.flag"]
    rename => ["Error_Code", "error.code"]
    rename => ["EventCode", "event.code"]
    rename => ["EventType", "event.category"]
    rename => ["Exit_Status", "botes.process.exit.status"]
    rename => ["File_Name", "file.path"]
    rename => ["Flight_Signing", "winlog.flight_signing.flag"]
    rename => ["Group_Domain", "botes.user.group.domain"]
    rename => ["Group_Name", "user.group.name"]
    rename => ["Handle_ID", "winlog.handle_id"]
    rename => ["HyperVisor_Debugging", "winlog.hypervisor_debug.flag"]
    rename => ["HyperVisor_Launch_Type", "winlog.hypervisor_launch_type"]
    rename => ["HyperVisor_Load_Options", "winlog.hypervisor_load_options"]
    rename => ["Impersonation_Level", "winlog.impersonation"]
    rename => ["Kernel_Debugging", "winlog.kernel_debug.flag"]
    rename => ["Key_Length", "winlog.ntlm.key_length"]
    rename => ["Keywords", "winlog.keywords"]
    rename => ["Linked_Logon_ID", "winlog.linked.logon.id"]
    rename => ["Link_Name", "file.target_path"]
    rename => ["Load_Options", "winlog.boot_options"]
    rename => ["LogName", "event.category"]
    rename => ["Logon_Account", "source.user.name"]
    rename => ["Logon_GUID", "source.user.id"]
    rename => ["Logon_ID", "winlog.logon.id"]
    rename => ["Logon_Process", "winlog.logon.process"]
    rename => ["Logon_Process_Name", "winlog.logon.process"]
    rename => ["Logon_Type", "winlog.logon.type"]
    rename => ["Mandatory_Label", "winlog.integrity.label"]
    rename => ["Name", "process.executable"]
    rename => ["Network_Account_Domain", "destination.user.domain"]
    rename => ["Network_Account_Name", "destination.user.name"]
    rename => ["Network_Address", "source.ip"]
    rename => ["New_Process_ID", "process.pid"]
    rename => ["New_Process_Name", "process.name"]
    rename => ["New_Security_Descriptor", "winlog.sddl.new"]
    rename => ["New_State", "winlog.transaction.state"]
    rename => ["New_Time", "winlog.new_time"]
    rename => ["Notification_Package_Name", "winlog.notification.package"]
    rename => ["Number_of_Elements", "winlog.user.per_policy"]
    rename => ["Object_Handle", "winlog.handle.id"]
    rename => ["Object_Name", "winlog.object.name"]
    rename => ["Object_Server", "winlog.subsystem.name"]
    rename => ["Object_Type", "winlog.object.type"]
    rename => ["OpCode", "winlog.opcode"]
    rename => ["Original_Security_Descriptor", "winlog.sddl.old"]
    rename => ["Package_Name__NTLM_only_", "winlog.ntlm.sub_package"]
    rename => ["Peer_Name", "winlog.rpc.peer_name"]
    rename => ["Policy_ID", "winlog.policy.id"]
    rename => ["Port", "source.port"]
    rename => ["Previous_Time", "winlog.old_time"]
    rename => ["Privileges", "winlog.requested.privileges"]
    rename => ["Privileges_Used_for_Access_Check", "winlog.access_check.privileges"]
    rename => ["Process_Command_Line", "botes.process.full"]
    rename => ["Process_ID", "process.pid"]
    rename => ["Process_Name", "process.name"]
    rename => ["Protocol_Sequence", "winlog.rpc.sequence"]
    rename => ["message", "event.original"]
    rename => ["RecordNumber", "event.sequence"]
    rename => ["Relative_Target_Name", "file.target_path"]
    rename => ["Resource_Attributes", "winlog.file.attributes"]
    rename => ["Resource_Manager", "winlog.resource_mgr.id"]
    rename => ["Restricted_Admin_Mode", "winlog.admin_mode.flag"]
    rename => ["Restricted_SID_Count", "winlog.restricted_sid.count"]
    rename => ["RM_Transaction_ID", "winlog.resource_mgr.transac_id"]
    rename => ["Security_Error", "wilong.rpc.error"]
    rename => ["Security_ID", "winlog.object.identifier"]
    rename => ["Security_Package_Name", "winlog.auth.loaded"]
    rename => ["Server", "winlog.subsystem.name"]
    rename => ["Service_Account", "winlog.service.account"]
    rename => ["Service_File_Name", "botes.service.file.path"]
    rename => ["Service_Name", "service.name"]
    rename => ["Service_Start_Type", "botes.service.start_type"]
    rename => ["Service_Type", "service.type"]
    rename => ["Session_ID", "winlog.session.id"]
    rename => ["Share_Name", "winlog.share.name"]
    rename => ["Share_Path", "winlog.share.path"]
    rename => ["Source_Address", "source.ip"]
    rename => ["SourceName", "event.provider"]
    rename => ["Source_Network_Address", "source.ip"]
    rename => ["Source_Port", "source.port"]
    rename => ["Source_Workstation", "botes.source.hostname"]
    rename => ["subject", "botes.event.description"]
    rename => ["System_Event_Logging", "winlog.event_logging.flag"]
    rename => ["Target_Server_Name", "botes.destination.hostname"]
    rename => ["TaskCategory", "winlog.task_category"]
    rename => ["Test_Signing", "winlog.test_signing.flag"]
    rename => ["time", "event.created"]
    rename => ["Token_Elevation_Type", "winlog.token_elevation.type"]
    rename => ["Token_Elevation_Type_id", "winlog.token_elevation.id"]
    rename => ["Transaction_ID", "winlog.transaction.id"]
    rename => ["Transited_Services", "winlog.transmitted_services"]
    rename => ["Type", "log.level"]
    rename => ["Virtual_Account", "winlog.virtual_account.flag"]
    rename => ["VSM_Launch_Type", "winlog.vsm_launch.type"]
    rename => ["Workstation_Name", "botes.source.hostname"]
  }
} 

output {  
  elasticsearch {
    index => "botes-wineventlog-security-%{+YYYY.MM.dd}"
    hosts => "${ELASTIC_HOSTS}"
    user => "${ELASTIC_USER}"
    password => "${ELASTIC_PASSWORD}"
    cacert => "certs/ca/ca.crt"
  } 
}